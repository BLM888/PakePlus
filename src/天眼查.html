<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>天眼系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind自定义颜色和字体 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'deep-blue': '#0B1C48',
            'space-black': '#050A1A',
            'warm-gold': '#D4AF37',
            'neon-blue': '#1E90FF',
            'glow-blue': '#00FFFF',
          },
          fontFamily: {
            'cyber': ['Orbitron', 'sans-serif'],
          },
          animation: {
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'glow': 'glow 2s ease-in-out infinite alternate',
          },
          keyframes: {
            glow: {
              '0%': { textShadow: '0 0 5px #fff, 0 0 10px #1E90FF, 0 0 15px #1E90FF' },
              '100%': { textShadow: '0 0 10px #fff, 0 0 20px #00FFFF, 0 0 30px #00FFFF' },
            }
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-glow {
        text-shadow: 0 0 10px rgba(30, 144, 255, 0.8), 0 0 20px rgba(30, 144, 255, 0.5);
      }
      .border-glow {
        box-shadow: 0 0 5px rgba(30, 144, 255, 0.8), 0 0 10px rgba(30, 144, 255, 0.5);
      }
      .bg-grid {
        background-image: 
          linear-gradient(rgba(30, 144, 255, 0.1) 1px, transparent 1px),
          linear-gradient(90deg, rgba(30, 144, 255, 0.1) 1px, transparent 1px);
        background-size: 20px 20px;
      }
      .glass-effect {
        background: rgba(11, 28, 72, 0.4);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }
      .progress-bar {
        height: 6px;
        border-radius: 3px;
        overflow: hidden;
      }
      .progress-value {
        height: 100%;
        transition: width 1s ease-in-out;
      }
      .modal-scroll {
        max-height: 70vh;
        overflow-y: auto;
      }
      .error-border {
        border-color: #dc2626 !important;
      }
      .error-text {
        color: #f87171;
        font-size: 0.875rem;
        margin-top: 0.25rem;
      }
      /* Windows系统适配样式 */
      .win-btn {
        -webkit-app-region: no-drag;
        transition: all 0.1s ease;
      }
      .win-btn:active {
        transform: scale(0.95);
      }
      .no-drag {
        -webkit-app-region: no-drag;
      }
      .drag-region {
        -webkit-app-region: drag;
      }
    }
  </style>
  
  <!-- 预加载字体 -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" as="style">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="bg-space-black text-gray-200 min-h-screen bg-grid overflow-x-hidden">
  <!-- 顶部导航栏 - 可拖拽区域 -->
  <header class="relative glass-effect border-b border-neon-blue/30 py-4 px-6 drag-region">
    <div class="container mx-auto flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <i class="fa fa-database text-warm-gold text-3xl animate-pulse-slow"></i>
        <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-cyber font-bold text-white animate-glow">
          天眼系统
        </h1>
      </div>
      
      <div class="hidden md:flex items-center space-x-6">
        <div class="flex items-center text-sm">
          <i class="fa fa-user-circle text-neon-blue mr-2"></i>
          <span>菠萝蜜高级管理员</span>
        </div>
        <div class="flex items-center text-sm">
          <i class="fa fa-clock-o text-neon-blue mr-2"></i>
          <span id="current-time">--:--:--</span>
        </div>
        <div class="flex items-center text-sm">
          <i class="fa fa-database text-neon-blue mr-2"></i>
          <span id="record-count">记录总数: 0</span>
        </div>
      </div>
    </div>
    
    <!-- 装饰性光晕效果 -->
    <div class="absolute -top-20 -right-20 w-64 h-64 bg-warm-gold/10 rounded-full blur-3xl"></div>
    <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-neon-blue/10 rounded-full blur-3xl"></div>
  </header>

  <main class="container mx-auto px-4 py-8 flex flex-col lg:flex-row gap-6">
    <!-- 左侧管理栏 -->
    <aside class="w-full lg:w-1/4 glass-effect rounded-lg p-4 border border-neon-blue/20 h-fit">
      <div class="flex flex-wrap items-center justify-between gap-3">
        <h2 class="text-xl font-cyber font-semibold text-warm-gold flex items-center whitespace-nowrap">
          <i class="fa fa-cogs mr-2"></i>数据管理
        </h2>
        
        <div class="flex flex-wrap gap-2">
          <button id="add-person" class="win-btn text-left px-4 py-2 rounded hover:bg-deep-blue/50 transition-all duration-300 flex items-center text-sm whitespace-nowrap">
            <i class="fa fa-user-plus text-green-400 mr-2 w-5 text-center"></i>
            <span>添加人员</span>
          </button>
          <button id="update-data" class="win-btn text-left px-4 py-2 rounded hover:bg-deep-blue/50 transition-all duration-300 flex items-center text-sm whitespace-nowrap">
            <i class="fa fa-refresh text-neon-blue mr-2 w-5 text-center"></i>
            <span>更新数据</span>
          </button>
          <button id="clear-all" class="win-btn text-left px-4 py-2 rounded hover:bg-deep-blue/50 transition-all duration-300 flex items-center text-sm text-red-300 whitespace-nowrap">
            <i class="fa fa-trash mr-2 w-5 text-center"></i>
            <span>清空所有数据</span>
          </button>
        </div>
      </div>
      
      <div class="mt-4 pt-4 border-t border-neon-blue/20">
        <h3 class="text-md font-cyber mb-3 text-neon-blue flex items-center whitespace-nowrap">
          <i class="fa fa-info-circle mr-1"></i>系统信息
        </h3>
        <div class="space-y-3 text-sm text-gray-300">
          <p><span class="text-warm-gold">版本:</span> v2.3.1</p>
          <p><span class="text-warm-gold">数据库:</span> 活跃</p>
          <p><span class="text-warm-gold">连接数:</span> 1</p>
          <p><span class="text-warm-gold">服务器负荷:</span> 
            <span id="server-load">0%</span>
            <div class="progress-bar bg-deep-blue/50 mt-1">
              <div id="load-bar" class="progress-value bg-neon-blue" style="width: 0%"></div>
            </div>
          </p>
          <p><span class="text-warm-gold">服务器温度:</span> 
            <span id="server-temp">0°C</span>
            <div class="progress-bar bg-deep-blue/50 mt-1">
              <div id="temp-bar" class="progress-value bg-neon-blue" style="width: 0%"></div>
            </div>
          </p>
          <p><span class="text-warm-gold">状态:</span> 正常运行中</p>
        </div>
      </div>
    </aside>

    <!-- 右侧查询区域 -->
    <section class="flex-1 space-y-6">
      <!-- 查询卡片 -->
      <div class="glass-effect rounded-lg p-6 border border-neon-blue/20">
        <h2 class="text-xl font-cyber font-semibold mb-6 text-warm-gold border-b border-neon-blue/20 pb-2">
          <i class="fa fa-search mr-2"></i>信息查询
        </h2>
        
        <div class="space-y-4">
          <div class="flex flex-wrap gap-4">
            <div class="flex-1 min-w-[280px]">
              <label class="block text-sm text-gray-300 mb-1">查询类型</label>
              <div class="relative">
                <select id="query-type" class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 pr-8 focus:outline-none focus:border-warm-gold transition-colors appearance-none">
                  <option value="name">姓名</option>
                  <option value="id">身份证号</option>
                  <option value="phone">手机号</option>
                  <option value="qq">QQ号</option>
                  <option value="wechat">微信号</option>
                  <option value="douyin">抖音号</option>
                </select>
                <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none text-xs"></i>
              </div>
            </div>
            
            <div class="flex-1 min-w-[280px]">
              <label class="block text-sm text-gray-300 mb-1">查询内容</label>
              <div class="relative">
                <input type="text" id="query-content" placeholder="请输入查询内容..." 
                  class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
                <button id="query-btn" class="win-btn absolute right-1 top-1 bg-warm-gold/80 hover:bg-warm-gold text-space-black px-3 py-1 rounded text-sm transition-colors">
                  <i class="fa fa-search mr-1"></i>查询
                </button>
              </div>
              <div id="query-error" class="error-text hidden"></div>
            </div>
          </div>
          
          <div class="pt-2">
            <div class="flex items-center text-sm text-gray-400">
              <i class="fa fa-lightbulb-o text-warm-gold mr-2"></i>
              <span id="database-population">当前数据库人数: 2,689,451,234</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 结果展示区域 -->
      <div id="result-container" class="glass-effect rounded-lg p-6 border border-neon-blue/20 hidden">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-cyber font-semibold text-warm-gold border-b border-neon-blue/20 pb-2">
            <i class="fa fa-user mr-2"></i>查询结果
            <span id="result-count" class="ml-2 text-sm text-gray-400 font-normal"></span>
          </h2>
          <button id="close-results" class="win-btn text-gray-400 hover:text-white transition-colors">
            <i class="fa fa-times"></i> 关闭
          </button>
        </div>
        
        <div id="results" class="space-y-6">
          <!-- 结果将通过JavaScript动态生成 -->
        </div>
        
        <div id="no-result" class="py-12 text-center hidden">
          <i class="fa fa-search-minus text-5xl text-gray-500 mb-4"></i>
          <p class="text-gray-400">未找到匹配的记录</p>
        </div>
      </div>
      
      <!-- 数据列表 -->
      <div class="glass-effect rounded-lg p-6 border border-neon-blue/20">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-cyber font-semibold text-warm-gold">
            <i class="fa fa-list mr-2"></i>人员信息列表
          </h2>
          <div class="text-sm text-gray-400">
            <span id="display-count">显示 0 条记录</span>
          </div>
        </div>
        
        <div class="overflow-x-auto">
          <table class="w-full min-w-[800px]">
            <thead>
              <tr class="border-b border-neon-blue/20">
                <th class="text-left py-3 px-4 text-sm font-cyber text-neon-blue">姓名</th>
                <th class="text-left py-3 px-4 text-sm font-cyber text-neon-blue">身份证号</th>
                <th class="text-left py-3 px-4 text-sm font-cyber text-neon-blue">手机号</th>
                <th class="text-left py-3 px-4 text-sm font-cyber text-neon-blue">年龄</th>
                <th class="text-left py-3 px-4 text-sm font-cyber text-neon-blue">职业</th>
                <th class="text-left py-3 px-4 text-sm font-cyber text-neon-blue">操作</th>
              </tr>
            </thead>
            <tbody id="data-table-body">
              <tr>
                <td colspan="6" class="py-8 text-center text-gray-500">
                  <i class="fa fa-database mr-2"></i>数据加载中...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
  
  <!-- 模态框 - 添加/编辑人员 -->
  <div id="add-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
    <div class="glass-effect rounded-lg w-full max-w-md border border-neon-blue/30 relative">
      <button id="close-modal" class="win-btn absolute top-4 right-4 text-gray-400 hover:text-white">
        <i class="fa fa-times"></i>
      </button>
      
      <div class="modal-scroll p-6">
        <h3 id="modal-title" class="text-xl font-cyber font-semibold mb-4 text-warm-gold">添加人员信息</h3>
        
        <form id="add-form" class="space-y-4">
          <input type="hidden" id="edit-id" value="">
          
          <div>
            <label class="block text-sm text-gray-300 mb-1">姓名</label>
            <input type="text" id="name" required 
              class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
          </div>
          
          <div>
            <label class="block text-sm text-gray-300 mb-1">身份证号</label>
            <input type="text" id="id-card" required 
              class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
          </div>
          
          <div>
            <label class="block text-sm text-gray-300 mb-1">手机号</label>
            <input type="text" id="phone" required 
              class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
          </div>
          
          <div>
            <label class="block text-sm text-gray-300 mb-1">职业</label>
            <select id="occupation" required
              class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
              <option value="">请选择职业</option>
              <option value="警察">警察</option>
              <option value="工人">工人</option>
              <option value="无业游民">无业游民</option>
              <option value="学生">学生</option>
              <option value="医生">医生</option>
              <option value="消防员">消防员</option>
              <option value="教师">教师</option>
              <option value="工程师">工程师</option>
              <option value="程序员">程序员</option>
              <option value="商人">商人</option>
              <option value="农民">农民</option>
              <option value="护士">护士</option>
              <option value="律师">律师</option>
              <option value="记者">记者</option>
              <option value="公务员">公务员</option>
              <option value="厨师">厨师</option>
              <option value="司机">司机</option>
              <option value="演员">演员</option>
              <option value="作家">作家</option>
              <option value="军人">军人</option>
              <option value="设计师">设计师</option>
              <option value="理发师">理发师</option>
              <option value="服务员">服务员</option>
              <option value="售货员">售货员</option>
              <option value="保安">保安</option>
              <option value="保洁员">保洁员</option>
              <option value="退休人员">退休人员</option>
              <option value="其他">其他</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm text-gray-300 mb-1">QQ号</label>
            <input type="text" id="qq" 
              class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
          </div>
          
          <div>
            <label class="block text-sm text-gray-300 mb-1">微信号</label>
            <input type="text" id="wechat" 
              class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
          </div>
          
          <div>
            <label class="block text-sm text-gray-300 mb-1">抖音号</label>
            <input type="text" id="douyin" 
              class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
          </div>
          
          <div>
            <label class="block text-sm text-gray-300 mb-1">家庭住址</label>
            <input type="text" id="address" 
              class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
          </div>
          
          <div class="pt-2 border-t border-neon-blue/20">
            <h4 class="text-warm-gold text-sm mb-3">家庭成员信息（选填）</h4>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm text-gray-300 mb-1">父亲姓名</label>
                <input type="text" id="father-name" 
                  class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
              </div>
              
              <div>
                <label class="block text-sm text-gray-300 mb-1">父亲身份证号</label>
                <input type="text" id="father-id" 
                  class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
              </div>
              
              <div>
                <label class="block text-sm text-gray-300 mb-1">母亲姓名</label>
                <input type="text" id="mother-name" 
                  class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
              </div>
              
              <div>
                <label class="block text-sm text-gray-300 mb-1">母亲身份证号</label>
                <input type="text" id="mother-id" 
                  class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
              </div>
              
              <div>
                <label class="block text-sm text-gray-300 mb-1">子女信息（格式：姓名,身份证号;姓名,身份证号）</label>
                <input type="text" id="children-info" placeholder="例如：张三,110101199001011234;李四,110101199501011234"
                  class="no-drag w-full bg-deep-blue/50 border border-neon-blue/30 rounded px-4 py-2 focus:outline-none focus:border-warm-gold transition-colors">
              </div>
            </div>
          </div>
          
          <div class="pt-4">
            <button type="submit" class="win-btn w-full bg-warm-gold/80 hover:bg-warm-gold text-space-black py-2 rounded transition-colors font-medium">
              保存信息
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- 确认对话框 -->
  <div id="confirm-dialog" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
    <div class="glass-effect rounded-lg w-full max-w-md p-6 border border-neon-blue/30">
      <h3 class="text-xl font-cyber font-semibold mb-4 text-warm-gold">确认操作</h3>
      
      <p id="confirm-message" class="mb-6 text-gray-300">您确定要执行此操作吗？</p>
      
      <div class="flex gap-4">
        <button id="confirm-cancel" class="win-btn flex-1 bg-gray-700/50 hover:bg-gray-600 py-2 rounded transition-colors">
          取消
        </button>
        <button id="confirm-ok" class="win-btn flex-1 bg-red-600/80 hover:bg-red-600 py-2 rounded transition-colors">
          确认
        </button>
      </div>
    </div>
  </div>
  
  <!-- 详情模态框 -->
  <div id="detail-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
    <div class="glass-effect rounded-lg w-full max-w-2xl border border-neon-blue/30 relative">
      <button id="close-detail" class="win-btn absolute top-4 right-4 text-gray-400 hover:text-white">
        <i class="fa fa-times"></i>
      </button>
      
      <div class="modal-scroll p-6">
        <h3 class="text-xl font-cyber font-semibold mb-6 text-warm-gold">人员详细信息</h3>
        
        <div id="person-detail" class="space-y-6">
          <!-- 详情内容将通过JavaScript动态生成 -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- 通知提示 -->
  <div id="notification" class="fixed top-4 right-4 p-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50 max-w-xs"></div>

  <script>
    // 存储人员数据 - 使用localStorage键名区分系统数据和永久数据
    const PERMANENT_DATA_KEY = 'tianyan_permanent_people';
    const SYSTEM_DATA_KEY = 'tianyan_system_people';
    
    let peopleData = [];
    let searchResults = [];
    let currentAction = null;
    let currentIndex = -1;
    // 数据库人口基数（20-30亿之间）
    let basePopulation = 25689451234;
    
    // 真实的身份证地址码前6位
    const realAreaCodes = [
      110000, 110101, 110102, 110105, 120000, 120101, 120102, 130000, 130100, 130102,
      130200, 130202, 140000, 140100, 140105, 150000, 150100, 150102, 210000, 210100,
      210102, 210200, 210202, 220000, 220100, 220102, 230000, 230100, 230102, 310000,
      310101, 310104, 310105, 320000, 320100, 320102, 320200, 320202, 330000, 330100,
      330102, 330200, 330203, 340000, 340100, 340102, 340200, 340202, 350000, 350100,
      350102, 350200, 350203, 360000, 360100, 360102, 360200, 360202, 370000, 370100,
      370102, 370200, 370202, 410000, 410100, 410102, 410200, 410202, 420000, 420100,
      420102, 420200, 420202, 430000, 430100, 430102, 430200, 430202, 440000, 440100,
      440104, 440300, 440303, 450000, 450100, 450102, 450200, 450202, 460000, 460100,
      460105, 500000, 500101, 500102, 510000, 510100, 510104, 510200, 510202, 520000,
      520100, 520102, 520200, 520202, 530000, 530100, 530102, 530300, 530302, 540000,
      540100, 540102, 610000, 610100, 610102, 610200, 610202, 620000, 620100, 620102,
      630000, 630100, 630102, 640000, 640100, 640104, 650000, 650100, 650102
    ];
    
    // 常见姓氏
    const familyNames = ['赵', '钱', '孙', '李', '周', '吴', '郑', '王', '冯', '陈', '褚', '卫', '蒋', '沈', '韩', '杨', '朱', '秦', '尤', '许', '何', '吕', '施', '张', '孔', '曹', '严', '华', '金', '魏', '陶', '姜', '戚', '谢', '邹', '喻', '柏', '水', '窦', '章', '云', '苏', '潘', '葛', '奚', '范', '彭', '郎', '鲁', '韦', '昌', '马', '苗', '凤', '花', '方', '俞', '任', '袁', '柳', '酆', '鲍', '史', '唐', '费', '廉', '岑', '薛', '雷', '贺', '倪', '汤', '滕', '殷', '罗', '毕', '郝', '邬', '安', '常', '乐', '于', '时', '傅', '皮', '卞', '齐', '康', '伍', '余', '元', '卜', '顾', '孟', '平', '黄', '和', '穆', '萧', '尹'];
    
    // 常见名字
    const givenNames = ['伟', '芳', '娜', '秀英', '敏', '静', '强', '磊', '军', '洋', '勇', '艳', '杰', '涛', '明', '超', '军', '秀兰', '建华', '桂英', '晓川', '丽君', '建国', '小丽', '志刚', '曼凝', '小红', '婷婷', '桂兰', '玉华', '秀荣', '志强', '惠芳', '建平', '颖', '海涛', '天明', '俊杰', '玉兰', '文杰', '玉梅', '静', '秀华', '鹏飞', '丽', '芳', '琳', '红梅', '静', '海燕', '桂英', '秀兰', '志强', '建军', '晓燕', '伟', '秀珍', '敏', '娜', '伟', '静', '秀芳', '勇', '军', '洋', '艳', '杰', '涛', '明', '超', '秀兰', '建华', '桂英', '红梅', '建国', '小丽', '志刚', '小红', '婷婷', '韵涵', '一鸣', '亦菲'];
    
    // 常见职业
    const occupations = ['警察', '工人', '无业游民', '学生', '医生', '消防员', '教师', '工程师', '程序员', '商人', '农民', '护士', '律师', '记者', '公务员', '厨师', '司机', '演员', '作家', '军人', '设计师', '理发师', '服务员', '售货员', '保安', '保洁员', '退休人员', '其他'];
    
    // 常见地址
    const provinces = ['北京市', '上海市', '天津市', '重庆市', '河北省', '山西省', '辽宁省', '吉林省', '黑龙江省', '江苏省', '浙江省', '安徽省', '福建省', '江西省', '山东省', '河南省', '湖北省', '湖南省', '广东省', '海南省', '四川省', '贵州省', '云南省', '陕西省', '甘肃省', '青海省', '台湾省', '内蒙古自治区', '广西壮族自治区', '宁夏回族自治区', '新疆维吾尔自治区', '西藏自治区', '香港特别行政区', '澳门特别行政区'];
    
    // 从localStorage加载永久数据
    function loadPermanentData() {
      try {
        const data = localStorage.getItem(PERMANENT_DATA_KEY);
        return data ? JSON.parse(data) : [];
      } catch (e) {
        console.error('加载永久数据失败:', e);
        return [];
      }
    }
    
    // 保存永久数据到localStorage
    function savePermanentData(data) {
      try {
        localStorage.setItem(PERMANENT_DATA_KEY, JSON.stringify(data));
      } catch (e) {
        console.error('保存永久数据失败:', e);
      }
    }
    
    // 从localStorage加载系统数据
    function loadSystemData() {
      try {
        const data = localStorage.getItem(SYSTEM_DATA_KEY);
        return data ? JSON.parse(data) : [];
      } catch (e) {
        console.error('加载系统数据失败:', e);
        return [];
      }
    }
    
    // 保存系统数据到localStorage
    function saveSystemData(data) {
      try {
        localStorage.setItem(SYSTEM_DATA_KEY, JSON.stringify(data));
      } catch (e) {
        console.error('保存系统数据失败:', e);
      }
    }
    
    // 生成随机姓名
    function generateName() {
      const familyName = familyNames[Math.floor(Math.random() * familyNames.length)];
      const givenName = givenNames[Math.floor(Math.random() * givenNames.length)];
      return familyName + givenName;
    }
    
    // 提取姓氏
    function getFamilyName(fullName) {
      if (!fullName) return '';
      return fullName.charAt(0);
    }
    
    // 提取名字
    function getGivenName(fullName) {
      if (!fullName || fullName.length <= 1) return fullName;
      return fullName.substring(1);
    }
    
    // 生成随机身份证号
    function generateIdCard() {
      // 随机选择地址码
      const areaCode = realAreaCodes[Math.floor(Math.random() * realAreaCodes.length)];
      
      // 生成1950-2005年之间的出生日期
      const year = Math.floor(Math.random() * 56) + 1950;
      const month = Math.floor(Math.random() * 12) + 1;
      const day = Math.floor(Math.random() * 28) + 1; // 简化处理，统一按28天算
      
      const birthDate = `${year}${String(month).padStart(2, '0')}${String(day).padStart(2, '0')}`;
      
      // 生成3位顺序码
      const sequence = String(Math.floor(Math.random() * 1000)).padStart(3, '0');
      
      // 随机生成校验码
      const checkCodes = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'X'];
      const checkCode = checkCodes[Math.floor(Math.random() * checkCodes.length)];
      
      return `${areaCode}${birthDate}${sequence}${checkCode}`;
    }
    
    // 生成随机手机号
    function generatePhone() {
      const prefixes = ['130', '131', '132', '133', '134', '135', '136', '137', '138', '139', '150', '151', '152', '153', '155', '156', '157', '158', '159', '170', '171', '173', '176', '177', '178', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189'];
      const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
      const suffix = Math.floor(Math.random() * 100000000).toString().padStart(8, '0');
      return prefix + suffix;
    }
    
    // 从身份证号计算年龄
    function calculateAge(idCard) {
      if (idCard.length !== 18) return 0;
      
      const birthYear = parseInt(idCard.substring(6, 10));
      const birthMonth = parseInt(idCard.substring(10, 12));
      const birthDay = parseInt(idCard.substring(12, 14));
      
      const today = new Date();
      const currentYear = today.getFullYear();
      const currentMonth = today.getMonth() + 1;
      const currentDay = today.getDate();
      
      let age = currentYear - birthYear;
      
      // 如果还没过生日，年龄减1
      if (currentMonth < birthMonth || (currentMonth === birthMonth && currentDay < birthDay)) {
        age--;
      }
      
      return age < 0 ? 0 : age;
    }
    
    // 生成随机地址
    function generateAddress() {
      const province = provinces[Math.floor(Math.random() * provinces.length)];
      const city = `${Math.floor(Math.random() * 10) + 1}市`;
      const district = `${Math.floor(Math.random() * 20) + 1}区`;
      const street = `${Math.floor(Math.random() * 100) + 1}街道`;
      const number = `${Math.floor(Math.random() * 1000) + 1}号`;
      const unit = `(${Math.floor(Math.random() * 20) + 1}单元${Math.floor(Math.random() * 30) + 1}室)`;
      
      return `${province}${city}${district}${street}${number}${unit}`;
    }
    
    // 生成随机QQ号
    function generateQQ() {
      return Math.floor(10000000 + Math.random() * 900000000).toString();
    }
    
    // 生成随机微信号
    function generateWechat() {
      const prefixes = ['wx', 'wxid', 'v', 'wx_', 'wechat_'];
      const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
      const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
      let suffix = '';
      
      for (let i = 0; i < Math.floor(Math.random() * 8) + 6; i++) {
        suffix += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      
      return prefix + suffix;
    }
    
    // 生成随机抖音号
    function generateDouyin() {
      const prefixes = ['dy', 'douyin', ''];
      const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
      const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
      let suffix = '';
      
      for (let i = 0; i < Math.floor(Math.random() * 6) + 8; i++) {
        suffix += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      
      return prefix + suffix;
    }
    
    // 生成随机人员数据
    function generatePerson(customFields = {}) {
      // 生成一个随机的孩子
      const childFamilyName = familyNames[Math.floor(Math.random() * familyNames.length)];
      const childGivenName = givenNames[Math.floor(Math.random() * givenNames.length)];
      const childName = childFamilyName + childGivenName;
      
      // 父亲随子女姓（父亲的姓等于孩子的姓）
      const fatherFamilyName = childFamilyName;
      const fatherGivenName = givenNames[Math.floor(Math.random() * givenNames.length)];
      const fatherName = fatherFamilyName + fatherGivenName;
      
      // 母亲姓名随机生成
      const motherFamilyName = familyNames[Math.floor(Math.random() * familyNames.length)];
      const motherGivenName = givenNames[Math.floor(Math.random() * givenNames.length)];
      const motherName = motherFamilyName + motherGivenName;
      
      // 如果有自定义字段，则使用自定义字段的值
      const name = customFields.name || generateName();
      const id = customFields.id || generateIdCard();
      const phone = customFields.phone || generatePhone();
      const occupation = customFields.occupation || occupations[Math.floor(Math.random() * occupations.length)];
      const age = calculateAge(id);
      const qq = customFields.qq || (Math.random() > 0.3 ? generateQQ() : ''); // 30%概率没有QQ号
      const wechat = customFields.wechat || (Math.random() > 0.2 ? generateWechat() : ''); // 20%概率没有微信号
      const douyin = customFields.douyin || (Math.random() > 0.6 ? generateDouyin() : ''); // 60%概率没有抖音号
      const address = customFields.address || generateAddress();
      
      // 随机生成子女信息（子女随父亲姓）
      const hasChildren = Math.random() > 0.3; // 70%概率有子女
      let childrenInfo = '';
      
      if (hasChildren) {
        const childCount = Math.floor(Math.random() * 3) + 1; // 1-3个子女
        const children = [];
        
        // 父亲的姓
        const personFamilyName = getFamilyName(name);
        
        for (let i = 0; i < childCount; i++) {
          // 子女随父亲姓
          const childGivenName = givenNames[Math.floor(Math.random() * givenNames.length)];
          const childFullName = personFamilyName + childGivenName;
          children.push(`${childFullName},${generateIdCard()}`);
        }
        
        childrenInfo = children.join(';');
      }
      
      // 随机决定是否显示父亲信息（约50%概率）
      const showFatherInfo = Math.random() > 0.5;
      // 随机决定是否显示母亲信息（约50%概率）
      const showMotherInfo = Math.random() > 0.5;
      
      return {
        name,
        id,
        phone,
        occupation,
        age,
        qq,
        wechat,
        douyin,
        address,
        fatherName: showFatherInfo ? fatherName : '',
        fatherId: showFatherInfo ? generateIdCard() : '',
        motherName: showMotherInfo ? motherName : '',
        motherId: showMotherInfo ? generateIdCard() : '',
        childrenInfo: childrenInfo
      };
    }
    
    // 生成多条随机数据
    function generatePeopleData(count = 10, customFields = {}) {
      const data = [];
      for (let i = 0; i < count; i++) {
        data.push(generatePerson(customFields));
      }
      return data;
    }
    
    // 验证身份证号格式
    function validateIdCard(idCard) {
      const reg = /(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
      return reg.test(idCard);
    }
    
    // 验证手机号格式
    function validatePhone(phone) {
      const reg = /^1[3-9]\d{9}$/;
      return reg.test(phone);
    }
    
    // 显示通知
    function showNotification(message, isError = false) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg transform transition-transform duration-300 z-50 max-w-xs ${isError ? 'bg-red-600/90 text-white' : 'bg-green-600/90 text-white'}`;
      
      // 显示通知
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 10);
      
      // 3秒后隐藏通知
      setTimeout(() => {
        notification.style.transform = 'translateX(calc(100% + 20px))';
      }, 3000);
    }
    
    // 更新表格显示
    function updateTable() {
      const tableBody = document.getElementById('data-table-body');
      
      if (peopleData.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="6" class="py-8 text-center text-gray-500">
              <i class="fa fa-database mr-2"></i>暂无数据，请添加数据
            </td>
          </tr>
        `;
        document.getElementById('display-count').textContent = '显示 0 条记录';
        return;
      }
      
      let html = '';
      peopleData.forEach((person, index) => {
        // 检查是否为永久数据
        const permanentData = loadPermanentData();
        const isPermanent = permanentData.some(p => p.id === person.id);
        
        html += `
          <tr class="border-b border-neon-blue/10 hover:bg-deep-blue/20 transition-colors">
            <td class="py-3 px-4">
              ${person.name}
              ${isPermanent ? '<span class="ml-2 text-xs bg-warm-gold/20 text-warm-gold px-1 rounded">永久</span>' : ''}
            </td>
            <td class="py-3 px-4">${person.id}</td>
            <td class="py-3 px-4">${person.phone}</td>
            <td class="py-3 px-4">${person.age}</td>
            <td class="py-3 px-4">${person.occupation}</td>
            <td class="py-3 px-4">
              <div class="flex space-x-2">
                <button onclick="viewPerson(${index})" class="win-btn text-neon-blue hover:text-glow-blue transition-colors" title="查看">
                  <i class="fa fa-eye"></i>
                </button>
                <button onclick="editPerson(${index})" class="win-btn text-warm-gold hover:text-yellow-300 transition-colors" title="编辑">
                  <i class="fa fa-edit"></i>
                </button>
                <button onclick="deletePerson(${index})" class="win-btn text-red-400 hover:text-red-300 transition-colors" title="删除">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        `;
      });
      
      tableBody.innerHTML = html;
      document.getElementById('display-count').textContent = `显示 ${peopleData.length} 条记录`;
    }
    
    // 更新记录计数
    function updateRecordCount() {
      document.getElementById('record-count').textContent = `记录总数: ${peopleData.length}`;
      
      // 随机波动数据库人口数量（±1000万范围内）
      const fluctuation = Math.floor(Math.random() * 20000000) - 10000000;
      const currentPopulation = basePopulation + fluctuation;
      
      // 格式化显示
      document.getElementById('database-population').textContent = 
        `当前数据库人数: ${currentPopulation.toLocaleString()}`;
    }
    
    // 更新服务器状态
    function updateServerStats() {
      // 生成随机服务器负荷 (10-60%)
      const load = Math.floor(Math.random() * 51) + 10;
      document.getElementById('server-load').textContent = `${load}%`;
      document.getElementById('load-bar').style.width = `${load}%`;
      
      // 生成随机服务器温度 (30-60°C)
      const temp = Math.floor(Math.random() * 31) + 30;
      document.getElementById('server-temp').textContent = `${temp}°C`;
      // 温度百分比映射 (30°C=20%, 60°C=80%)
      const tempPercent = ((temp - 30) / 30) * 60 + 20;
      document.getElementById('temp-bar').style.width = `${tempPercent}%`;
      
      // 根据温度改变颜色
      const tempBar = document.getElementById('temp-bar');
      if (temp < 40) {
        tempBar.className = 'progress-value bg-neon-blue';
      } else if (temp < 50) {
        tempBar.className = 'progress-value bg-green-500';
      } else {
        tempBar.className = 'progress-value bg-yellow-500';
      }
    }
    
    // 更新时间显示
    function updateTime() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      document.getElementById('current-time').textContent = `${hours}:${minutes}:${seconds}`;
    }
    
    // 打开添加人员模态框
    function openAddModal() {
      document.getElementById('modal-title').textContent = '添加人员信息';
      document.getElementById('edit-id').value = '';
      document.getElementById('add-form').reset();
      document.getElementById('add-modal').classList.remove('hidden');
    }
    
    // 关闭模态框
    function closeModal() {
      document.getElementById('add-modal').classList.add('hidden');
    }
    
    // 打开详情模态框
    function viewPerson(index) {
      const person = peopleData[index];
      if (!person) return;
      
      // 解析子女信息
      let childrenHtml = '';
      if (person.childrenInfo) {
        const children = person.childrenInfo.split(';');
        childrenHtml = '<ul class="list-disc list-inside pl-4">';
        children.forEach(child => {
          const [name, id] = child.split(',');
          childrenHtml += `<li>${name} (${id || ''})</li>`;
        });
        childrenHtml += '</ul>';
      } else {
        childrenHtml = '<p>无记录</p>';
      }
      
      // 构建详情HTML
      const detailHtml = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <h4 class="text-warm-gold text-sm mb-1">姓名</h4>
            <p>${person.name}</p>
          </div>
          <div>
            <h4 class="text-warm-gold text-sm mb-1">身份证号</h4>
            <p>${person.id}</p>
          </div>
          <div>
            <h4 class="text-warm-gold text-sm mb-1">手机号</h4>
            <p>${person.phone}</p>
          </div>
          <div>
            <h4 class="text-warm-gold text-sm mb-1">年龄</h4>
            <p>${person.age}</p>
          </div>
          <div>
            <h4 class="text-warm-gold text-sm mb-1">职业</h4>
            <p>${person.occupation}</p>
          </div>
          <div>
            <h4 class="text-warm-gold text-sm mb-1">QQ号</h4>
            <p>${person.qq || '未填写'}</p>
          </div>
          <div>
            <h4 class="text-warm-gold text-sm mb-1">微信号</h4>
            <p>${person.wechat || '未填写'}</p>
          </div>
          <div>
            <h4 class="text-warm-gold text-sm mb-1">抖音号</h4>
            <p>${person.douyin || '未填写'}</p>
          </div>
          <div class="md:col-span-2">
            <h4 class="text-warm-gold text-sm mb-1">家庭住址</h4>
            <p>${person.address}</p>
          </div>
        </div>
        
        <div class="pt-4 border-t border-neon-blue/20">
          <h4 class="text-warm-gold text-sm mb-3">家庭成员信息</h4>
          
          <div class="space-y-4">
            <div>
              <h5 class="text-gray-300 text-sm mb-1">父亲</h5>
              <p>${person.fatherName || '未填写'} ${person.fatherId ? `(${person.fatherId})` : ''}</p>
            </div>
            
            <div>
              <h5 class="text-gray-300 text-sm mb-1">母亲</h5>
              <p>${person.motherName || '未填写'} ${person.motherId ? `(${person.motherId})` : ''}</p>
            </div>
            
            <div>
              <h5 class="text-gray-300 text-sm mb-1">子女</h5>
              ${childrenHtml}
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('person-detail').innerHTML = detailHtml;
      document.getElementById('detail-modal').classList.remove('hidden');
    }
    
    // 关闭详情模态框
    function closeDetailModal() {
      document.getElementById('detail-modal').classList.add('hidden');
    }
    
    // 编辑人员信息
    function editPerson(index) {
      const person = peopleData[index];
      if (!person) return;
      
      // 填充表单数据
      document.getElementById('modal-title').textContent = '编辑人员信息';
      document.getElementById('edit-id').value = person.id;
      document.getElementById('name').value = person.name;
      document.getElementById('id-card').value = person.id;
      document.getElementById('phone').value = person.phone;
      document.getElementById('occupation').value = person.occupation;
      document.getElementById('qq').value = person.qq || '';
      document.getElementById('wechat').value = person.wechat || '';
      document.getElementById('douyin').value = person.douyin || '';
      document.getElementById('address').value = person.address;
      document.getElementById('father-name').value = person.fatherName || '';
      document.getElementById('father-id').value = person.fatherId || '';
      document.getElementById('mother-name').value = person.motherName || '';
      document.getElementById('mother-id').value = person.motherId || '';
      document.getElementById('children-info').value = person.childrenInfo || '';
      
      // 记录当前编辑的索引
      currentIndex = index;
      
      // 显示模态框
      document.getElementById('add-modal').classList.remove('hidden');
    }
    
    // 删除人员信息
    function deletePerson(index) {
      const person = peopleData[index];
      if (!person) return;
      
      // 检查是否为永久数据
      const permanentData = loadPermanentData();
      const isPermanent = permanentData.some(p => p.id === person.id);
      
      if (isPermanent) {
        showNotification('无法删除永久数据', true);
        return;
      }
      
      // 显示确认对话框
      currentAction = 'delete';
      currentIndex = index;
      document.getElementById('confirm-message').textContent = `您确定要删除 ${person.name} 的信息吗？`;
      document.getElementById('confirm-dialog').classList.remove('hidden');
    }
    
    // 处理添加/编辑表单提交
    function handleAddFormSubmit(e) {
      e.preventDefault();
      
      // 获取表单数据
      const id = document.getElementById('id-card').value.trim();
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const occupation = document.getElementById('occupation').value;
      const qq = document.getElementById('qq').value.trim();
      const wechat = document.getElementById('wechat').value.trim();
      const douyin = document.getElementById('douyin').value.trim();
      const address = document.getElementById('address').value.trim();
      const fatherName = document.getElementById('father-name').value.trim();
      const fatherId = document.getElementById('father-id').value.trim();
      const motherName = document.getElementById('mother-name').value.trim();
      const motherId = document.getElementById('mother-id').value.trim();
      const childrenInfo = document.getElementById('children-info').value.trim();
      
      // 验证数据
      let isValid = true;
      
      if (!name) {
        showError('name', '请输入姓名');
        isValid = false;
      } else {
        clearError('name');
      }
      
      if (!id || !validateIdCard(id)) {
        showError('id-card', '请输入有效的身份证号');
        isValid = false;
      } else {
        clearError('id-card');
      }
      
      if (!phone || !validatePhone(phone)) {
        showError('phone', '请输入有效的手机号');
        isValid = false;
      } else {
        clearError('phone');
      }
      
      if (!occupation) {
        showError('occupation', '请选择职业');
        isValid = false;
      } else {
        clearError('occupation');
      }
      
      if (!isValid) return;
      
      // 创建人员对象
      const person = {
        name,
        id,
        phone,
        occupation,
        age: calculateAge(id),
        qq,
        wechat,
        douyin,
        address,
        fatherName,
        fatherId,
        motherName,
        motherId,
        childrenInfo
      };
      
      const editId = document.getElementById('edit-id').value;
      
      if (editId) {
        // 更新现有记录
        peopleData[currentIndex] = person;
        saveSystemData(peopleData.filter(p => !loadPermanentData().some(per => per.id === p.id)));
        showNotification('信息更新成功');
      } else {
        // 检查ID是否已存在
        if (peopleData.some(p => p.id === id)) {
          showError('id-card', '此身份证号已存在');
          return;
        }
        
        // 添加新记录
        peopleData.push(person);
        // 保存到系统数据
        const systemData = loadSystemData();
        systemData.push(person);
        saveSystemData(systemData);
        showNotification('信息添加成功');
      }
      
      // 关闭模态框并更新表格
      closeModal();
      updateTable();
      updateRecordCount();
    }
    
    // 显示错误信息
    function showError(fieldId, message) {
      const field = document.getElementById(fieldId);
      const errorElement = document.createElement('div');
      errorElement.className = 'error-text';
      errorElement.id = `${fieldId}-error`;
      errorElement.textContent = message;
      
      field.classList.add('error-border');
      
      // 如果错误元素已存在则替换，否则添加
      const existingError = document.getElementById(`${fieldId}-error`);
      if (existingError) {
        existingError.replaceWith(errorElement);
      } else {
        field.parentNode.appendChild(errorElement);
      }
    }
    
    // 清除错误信息
    function clearError(fieldId) {
      const field = document.getElementById(fieldId);
      const errorElement = document.getElementById(`${fieldId}-error`);
      
      field.classList.remove('error-border');
      if (errorElement) {
        errorElement.remove();
      }
    }
    
    // 处理清空所有数据
    function handleClearAll() {
      currentAction = 'clearAll';
      document.getElementById('confirm-message').textContent = '您确定要清空所有数据吗？此操作不可恢复！';
      document.getElementById('confirm-dialog').classList.remove('hidden');
    }
    
    // 处理更新数据
    function handleUpdateData() {
      // 生成5-15条新数据
      const newDataCount = Math.floor(Math.random() * 11) + 5;
      const newData = generatePeopleData(newDataCount);
      
      // 保留永久数据，替换系统数据
      const permanentData = loadPermanentData();
      peopleData = [...permanentData, ...newData];
      saveSystemData(newData);
      
      updateTable();
      updateRecordCount();
      showNotification(`已更新数据，新增 ${newDataCount} 条记录`);
    }
    
    // 关闭确认对话框
    function closeConfirmDialog() {
      document.getElementById('confirm-dialog').classList.add('hidden');
      currentAction = null;
      currentIndex = -1;
    }
    
    // 执行确认的操作
    function executeConfirmAction() {
      if (currentAction === 'delete' && currentIndex !== -1) {
        // 执行删除操作
        const deletedPerson = peopleData.splice(currentIndex, 1)[0];
        // 更新系统数据
        const systemData = loadSystemData();
        const updatedSystemData = systemData.filter(p => p.id !== deletedPerson.id);
        saveSystemData(updatedSystemData);
        
        updateTable();
        updateRecordCount();
        showNotification('信息已删除');
      } else if (currentAction === 'clearAll') {
        // 执行清空操作（保留永久数据）
        const permanentData = loadPermanentData();
        peopleData = [...permanentData];
        saveSystemData([]);
        
        updateTable();
        updateRecordCount();
        showNotification('所有数据已清空（保留永久数据）');
      }
      
      closeConfirmDialog();
    }
    
    // 执行搜索
    function performSearch() {
      const queryType = document.getElementById('query-type').value;
      const queryContent = document.getElementById('query-content').value.trim();
      
      if (!queryContent) {
        document.getElementById('query-error').textContent = '请输入查询内容';
        document.getElementById('query-error').classList.remove('hidden');
        document.getElementById('query-content').classList.add('error-border');
        return;
      }
      
      // 清除错误状态
      document.getElementById('query-error').classList.add('hidden');
      document.getElementById('query-content').classList.remove('error-border');
      
      // 执行搜索
      searchResults = peopleData.filter(person => {
        const value = person[queryType] || '';
        return value.toString().toLowerCase().includes(queryContent.toLowerCase());
      });
      
      // 显示结果
      const resultsContainer = document.getElementById('result-container');
      const resultsElement = document.getElementById('results');
      const noResultElement = document.getElementById('no-result');
      const resultCountElement = document.getElementById('result-count');
      
      resultsContainer.classList.remove('hidden');
      resultCountElement.textContent = `共 ${searchResults.length} 条记录`;
      
      if (searchResults.length === 0) {
        resultsElement.classList.add('hidden');
        noResultElement.classList.remove('hidden');
        return;
      }
      
      resultsElement.classList.remove('hidden');
      noResultElement.classList.add('hidden');
      
      // 构建结果HTML
      let resultsHtml = '';
      searchResults.forEach((person, index) => {
        resultsHtml += `
          <div class="border border-neon-blue/20 rounded-lg p-4 hover:border-warm-gold/50 transition-colors">
            <div class="flex justify-between items-start">
              <div>
                <h3 class="text-lg font-cyber text-warm-gold">${person.name}</h3>
                <p class="text-sm text-gray-400">身份证号: ${person.id}</p>
              </div>
              <button onclick="viewPerson(${peopleData.indexOf(person)})" class="win-btn text-neon-blue hover:text-glow-blue transition-colors">
                <i class="fa fa-eye mr-1"></i> 查看详情
              </button>
            </div>
            
            <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
              <div><span class="text-neon-blue">手机号:</span> ${person.phone}</div>
              <div><span class="text-neon-blue">年龄:</span> ${person.age}</div>
              <div><span class="text-neon-blue">职业:</span> ${person.occupation}</div>
              <div><span class="text-neon-blue">地址:</span> ${person.address.substring(0, 20)}${person.address.length > 20 ? '...' : ''}</div>
            </div>
          </div>
        `;
      });
      
      resultsElement.innerHTML = resultsHtml;
    }
    
    // 关闭搜索结果
    function closeResults() {
      document.getElementById('result-container').classList.add('hidden');
    }
    
    // 页面加载时初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 性能优化：使用requestIdleCallback延迟加载非关键数据
      if ('requestIdleCallback' in window) {
        requestIdleCallback(initializeData, { timeout: 1000 });
      } else {
        // 降级处理
        setTimeout(initializeData, 500);
      }
      
      // 绑定事件监听器
      document.getElementById('add-person').addEventListener('click', openAddModal);
      document.getElementById('close-modal').addEventListener('click', closeModal);
      document.getElementById('add-form').addEventListener('submit', handleAddFormSubmit);
      document.getElementById('clear-all').addEventListener('click', handleClearAll);
      document.getElementById('update-data').addEventListener('click', handleUpdateData);
      document.getElementById('confirm-cancel').addEventListener('click', closeConfirmDialog);
      document.getElementById('confirm-ok').addEventListener('click', executeConfirmAction);
      document.getElementById('query-btn').addEventListener('click', performSearch);
      document.getElementById('close-results').addEventListener('click', closeResults);
      document.getElementById('close-detail').addEventListener('click', closeDetailModal);
      
      // 支持回车键查询
      document.getElementById('query-content').addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
          performSearch();
        }
      });
      
      // 初始化时间显示
      updateTime();
      setInterval(updateTime, 1000);
    });
    
    // 初始化数据
    function initializeData() {
      // 从localStorage加载永久数据
      let permanentData = loadPermanentData();
      
      // 检查是否已有乔镘凝数据，如果没有则添加
      const hasQiaoManying = permanentData.some(person => person.name === '乔镘凝');
      if (!hasQiaoManying) {
        const qiaoManying = {
          name: '乔镘凝',
          id: '141000200505293687',
          phone: '13008021728',
          qq: '2304940922',
          douyin: 'xiaoqiao20050529',
          address: '山西省合肥市蜀山区',
          age: calculateAge('141000200505293687'),
          occupation: '无业游民',
          wechat: '',
          fatherName: '乔志远',
          fatherId: '141000197308213517',
          motherName: '乔湘红',
          motherId: '341200197312056421',
          childrenInfo: ''
        };
        permanentData.push(qiaoManying);
        savePermanentData(permanentData);
      }
      
      // 从localStorage加载系统数据
      let systemData = loadSystemData();
      
      // 如果系统数据为空，生成一些随机数据
      if (systemData.length === 0) {
        const count = Math.floor(Math.random() * 11) + 10;
        systemData = generatePeopleData(count);
        saveSystemData(systemData);
      }
      
      // 合并永久数据和系统数据
      peopleData = [...permanentData, ...systemData];
      
      // 更新表格显示
      updateTable();
      
      // 更新记录计数
      updateRecordCount();
      
      // 更新服务器状态
      updateServerStats();
      // 服务器状态更新频率为30秒一次
      setInterval(updateServerStats, 30000);
    }
    
    // 暴露函数到全局，供内联事件调用
    window.viewPerson = viewPerson;
    window.editPerson = editPerson;
    window.deletePerson = deletePerson;
    window.closeDetailModal = closeDetailModal;
  </script>
</body>
</html>